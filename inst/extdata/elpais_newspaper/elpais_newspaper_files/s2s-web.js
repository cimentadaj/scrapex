!function(){var t={7135:function(t,e,n){t.exports=n(6248)},6248:function(t){var e=function(t){"use strict";var e,n=Object.prototype,i=n.hasOwnProperty,r="function"==typeof Symbol?Symbol:{},o=r.iterator||"@@iterator",s=r.asyncIterator||"@@asyncIterator",a=r.toStringTag||"@@toStringTag";function u(t,e,n){return Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}),t[e]}try{u({},"")}catch(t){u=function(t,e,n){return t[e]=n}}function c(t,e,n,i){var r=e&&e.prototype instanceof p?e:p,o=Object.create(r.prototype),s=new T(i||[]);return o._invoke=function(t,e,n){var i=f;return function(r,o){if(i===d)throw new Error("Generator is already running");if(i===v){if("throw"===r)throw o;return x()}for(n.method=r,n.arg=o;;){var s=n.delegate;if(s){var a=E(s,n);if(a){if(a===m)continue;return a}}if("next"===n.method)n.sent=n._sent=n.arg;else if("throw"===n.method){if(i===f)throw i=v,n.arg;n.dispatchException(n.arg)}else"return"===n.method&&n.abrupt("return",n.arg);i=d;var u=l(t,e,n);if("normal"===u.type){if(i=n.done?v:h,u.arg===m)continue;return{value:u.arg,done:n.done}}"throw"===u.type&&(i=v,n.method="throw",n.arg=u.arg)}}}(t,n,s),o}function l(t,e,n){try{return{type:"normal",arg:t.call(e,n)}}catch(t){return{type:"throw",arg:t}}}t.wrap=c;var f="suspendedStart",h="suspendedYield",d="executing",v="completed",m={};function p(){}function y(){}function g(){}var b={};b[o]=function(){return this};var k=Object.getPrototypeOf,S=k&&k(k(O([])));S&&S!==n&&i.call(S,o)&&(b=S);var w=g.prototype=p.prototype=Object.create(b);function P(t){["next","throw","return"].forEach((function(e){u(t,e,(function(t){return this._invoke(e,t)}))}))}function I(t,e){function n(r,o,s,a){var u=l(t[r],t,o);if("throw"!==u.type){var c=u.arg,f=c.value;return f&&"object"==typeof f&&i.call(f,"__await")?e.resolve(f.__await).then((function(t){n("next",t,s,a)}),(function(t){n("throw",t,s,a)})):e.resolve(f).then((function(t){c.value=t,s(c)}),(function(t){return n("throw",t,s,a)}))}a(u.arg)}var r;this._invoke=function(t,i){function o(){return new e((function(e,r){n(t,i,e,r)}))}return r=r?r.then(o,o):o()}}function E(t,n){var i=t.iterator[n.method];if(i===e){if(n.delegate=null,"throw"===n.method){if(t.iterator.return&&(n.method="return",n.arg=e,E(t,n),"throw"===n.method))return m;n.method="throw",n.arg=new TypeError("The iterator does not provide a 'throw' method")}return m}var r=l(i,t.iterator,n.arg);if("throw"===r.type)return n.method="throw",n.arg=r.arg,n.delegate=null,m;var o=r.arg;return o?o.done?(n[t.resultName]=o.value,n.next=t.nextLoc,"return"!==n.method&&(n.method="next",n.arg=e),n.delegate=null,m):o:(n.method="throw",n.arg=new TypeError("iterator result is not an object"),n.delegate=null,m)}function R(t){var e={tryLoc:t[0]};1 in t&&(e.catchLoc=t[1]),2 in t&&(e.finallyLoc=t[2],e.afterLoc=t[3]),this.tryEntries.push(e)}function C(t){var e=t.completion||{};e.type="normal",delete e.arg,t.completion=e}function T(t){this.tryEntries=[{tryLoc:"root"}],t.forEach(R,this),this.reset(!0)}function O(t){if(t){var n=t[o];if(n)return n.call(t);if("function"==typeof t.next)return t;if(!isNaN(t.length)){var r=-1,s=function n(){for(;++r<t.length;)if(i.call(t,r))return n.value=t[r],n.done=!1,n;return n.value=e,n.done=!0,n};return s.next=s}}return{next:x}}function x(){return{value:e,done:!0}}return y.prototype=w.constructor=g,g.constructor=y,y.displayName=u(g,a,"GeneratorFunction"),t.isGeneratorFunction=function(t){var e="function"==typeof t&&t.constructor;return!!e&&(e===y||"GeneratorFunction"===(e.displayName||e.name))},t.mark=function(t){return Object.setPrototypeOf?Object.setPrototypeOf(t,g):(t.__proto__=g,u(t,a,"GeneratorFunction")),t.prototype=Object.create(w),t},t.awrap=function(t){return{__await:t}},P(I.prototype),I.prototype[s]=function(){return this},t.AsyncIterator=I,t.async=function(e,n,i,r,o){void 0===o&&(o=Promise);var s=new I(c(e,n,i,r),o);return t.isGeneratorFunction(n)?s:s.next().then((function(t){return t.done?t.value:s.next()}))},P(w),u(w,a,"Generator"),w[o]=function(){return this},w.toString=function(){return"[object Generator]"},t.keys=function(t){var e=[];for(var n in t)e.push(n);return e.reverse(),function n(){for(;e.length;){var i=e.pop();if(i in t)return n.value=i,n.done=!1,n}return n.done=!0,n}},t.values=O,T.prototype={constructor:T,reset:function(t){if(this.prev=0,this.next=0,this.sent=this._sent=e,this.done=!1,this.delegate=null,this.method="next",this.arg=e,this.tryEntries.forEach(C),!t)for(var n in this)"t"===n.charAt(0)&&i.call(this,n)&&!isNaN(+n.slice(1))&&(this[n]=e)},stop:function(){this.done=!0;var t=this.tryEntries[0].completion;if("throw"===t.type)throw t.arg;return this.rval},dispatchException:function(t){if(this.done)throw t;var n=this;function r(i,r){return a.type="throw",a.arg=t,n.next=i,r&&(n.method="next",n.arg=e),!!r}for(var o=this.tryEntries.length-1;o>=0;--o){var s=this.tryEntries[o],a=s.completion;if("root"===s.tryLoc)return r("end");if(s.tryLoc<=this.prev){var u=i.call(s,"catchLoc"),c=i.call(s,"finallyLoc");if(u&&c){if(this.prev<s.catchLoc)return r(s.catchLoc,!0);if(this.prev<s.finallyLoc)return r(s.finallyLoc)}else if(u){if(this.prev<s.catchLoc)return r(s.catchLoc,!0)}else{if(!c)throw new Error("try statement without catch or finally");if(this.prev<s.finallyLoc)return r(s.finallyLoc)}}}},abrupt:function(t,e){for(var n=this.tryEntries.length-1;n>=0;--n){var r=this.tryEntries[n];if(r.tryLoc<=this.prev&&i.call(r,"finallyLoc")&&this.prev<r.finallyLoc){var o=r;break}}o&&("break"===t||"continue"===t)&&o.tryLoc<=e&&e<=o.finallyLoc&&(o=null);var s=o?o.completion:{};return s.type=t,s.arg=e,o?(this.method="next",this.next=o.finallyLoc,m):this.complete(s)},complete:function(t,e){if("throw"===t.type)throw t.arg;return"break"===t.type||"continue"===t.type?this.next=t.arg:"return"===t.type?(this.rval=this.arg=t.arg,this.method="return",this.next="end"):"normal"===t.type&&e&&(this.next=e),m},finish:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var n=this.tryEntries[e];if(n.finallyLoc===t)return this.complete(n.completion,n.afterLoc),C(n),m}},catch:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var n=this.tryEntries[e];if(n.tryLoc===t){var i=n.completion;if("throw"===i.type){var r=i.arg;C(n)}return r}}throw new Error("illegal catch attempt")},delegateYield:function(t,n,i){return this.delegate={iterator:O(t),resultName:n,nextLoc:i},"next"===this.method&&(this.arg=e),m}},t}(t.exports);try{regeneratorRuntime=e}catch(t){Function("r","regeneratorRuntime = r")(e)}}},e={};function n(i){var r=e[i];if(void 0!==r)return r.exports;var o=e[i]={exports:{}};return t[i](o,o.exports,n),o.exports}n.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return n.d(e,{a:e}),e},n.d=function(t,e){for(var i in e)n.o(e,i)&&!n.o(t,i)&&Object.defineProperty(t,i,{enumerable:!0,get:e[i]})},n.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},function(){"use strict";var t=n(7135),e=n.n(t);function i(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}var r=function t(){i(this,t),this.forceImprTime=3,this.dnt=!0,this.segment={maxSegments:400,maxSegmentStateItems:86400,minSegmentDuration:1e3},this.enabled=!0,this.tsUrl="https://es-config.sensic.net/ts.json",this.projectVersion="1.0",this.configVersion=1,this.sdkVersion="2.1.0",this.tech="s2s-w",this.projectName="es1",this.trackingUrl="https://es1-s2s.sensic.net",this.streamCustom=["c1","c2","programmname","streamlength","channelname","airtime"],this.contentCustom=["c1","c2","c3","c4","c5","c6","c7","c8","c9","c10"],this.visibilityEnabled=!1,this.heartbeat={enabled:!0,interval:[1,1,1,1,1,1,1,1,1,1,5,5,5,5,5,10,10,10,10,10,20,20,20,20,20,30],maximum:0}};function o(t){return(o="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function s(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}function a(t,e,n){return e&&s(t.prototype,e),n&&s(t,n),t}var u={none:0,error:1,warn:2,info:3,log:4,debug:5},c=["none","debug","log","info","warn","error"],l=function(){function t(){i(this,t)}return a(t,null,[{key:"debug",value:function(e){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};t.output(e,"debug",n.coloring,n.extraObj)}},{key:"log",value:function(e){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};t.output(e,"log",n.coloring,n.extraObj)}},{key:"info",value:function(e){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};t.output(e,"info",n.coloring,n.extraObj)}},{key:"warn",value:function(e){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};t.output(e,"warn",n.coloring,n.extraObj)}},{key:"error",value:function(e){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};t.output(e,"error",n.coloring,n.extraObj)}},{key:"output",value:function(e){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"log",i=arguments.length>2?arguments[2]:void 0,r=arguments.length>3?arguments[3]:void 0;if(!(u[n]>u[t.logLevel])){if(t.url&&XMLHttpRequest){var s=new XMLHttpRequest,a=t.url+"?"+n+"="+encodeURIComponent(e+(r?"\n"+JSON.stringify(r):""))+"&src=S2S";s.open("GET",a,!0),s.send()}if("undefined"!=typeof console){var c=(i?"%c ":"")+e+(i?" %c":""),l=console;"function"==typeof l[n]?"fcall"===i?r?l[n]("GFK: "+c,"background: #060; color: #fff","","object"===o(r)&&Array.from?Array.from(r):r):l[n]("GFK: "+c,"background: #060; color: #fff",""):"request"===i?l[n]("GFK: "+c,"background: #059; color: #fff","",r):l[n]("GFK: "+c):l.error("GFK: "+c)}}}},{key:"formatDuration",value:function(t){var e=t%1e3,n=(t=(t-e)/1e3)%60,i=(t=(t-n)/60)%60,r=(t-i)/60;return(r?r+":":"")+("0"+i).slice(-2)+":"+("0"+n).slice(-2)+"."+("00"+e).slice(-3)}},{key:"readFromTagConf",value:function(){this.readFromConf(window.gfkS2sConf)}},{key:"readFromConnectorConf",value:function(){this.readFromConf(window.gfkConnectorConf)}},{key:"readFromLocalStorage",value:function(){try{if(window.localStorage){var e=window.localStorage.getItem("sensic-logLevel");f(e)&&(t.logLevel=e)}}catch(t){console.warn("Couldn't read log settings from local storage:",t)}}},{key:"readFromConf",value:function(e){f(null==e?void 0:e.logLevel)&&(t.logLevel=e.logLevel),(null==e?void 0:e.logUrl)&&(t.url=e.logUrl)}}]),t}();function f(t){return c.includes(t)}l.logLevel="none",l.url=null;var h=function(t,e,n,i){return new(n||(n=Promise))((function(r,o){function s(t){try{u(i.next(t))}catch(t){o(t)}}function a(t){try{u(i.throw(t))}catch(t){o(t)}}function u(t){var e;t.done?r(t.value):(e=t.value,e instanceof n?e:new n((function(t){t(e)}))).then(s,a)}u((i=i.apply(t,e||[])).next())}))},d=function(){function t(e){i(this,t),this.appType=e.hasOwnProperty("type")?e.type:"WEB";var n=t.getParticularDeviceType(),r=e.hasOwnProperty("device")?e.device:"UNKNOWN";this.deviceType="UNKNOWN"===n?r:n}return a(t,[{key:"getOrigin",value:function(){return t.isWebContext()?window.location.protocol+"//"+window.location.hostname:""}},{key:"getLanguage",value:function(){if(!t.isWebContext())return"";var e=window.navigator;return e.language||e.userLanguage}},{key:"getProjectStatus",value:function(){return t.config.enabled}},{key:"getContentCustomParameter",value:function(){return t.config.contentCustom}},{key:"getStreamCustomParameter",value:function(){return t.config.streamCustom}},{key:"getVersion",value:function(){return t.config.projectVersion+"/"+t.config.sdkVersion+"/"+t.config.configVersion}},{key:"getTechnology",value:function(){return t.config.tech}},{key:"getProjectName",value:function(){return t.config.projectName}},{key:"getTrackingUrl",value:function(){return t.config.trackingUrl}},{key:"getHeartbeatSettings",value:function(){return t.config.heartbeat}},{key:"getSegmentSettings",value:function(){return t.config.segment}},{key:"getAppType",value:function(){return this.appType}},{key:"getDeviceType",value:function(){if("undefined"!=typeof window){var t=window;if(t.cast)if("CONNECTED"===t.cast.framework.CastContext.getInstance().getCastState())return"chromecast"}return this.deviceType}}],[{key:"setSui",value:function(e){t.sui=e?JSON.stringify(e):"","object"===o(window.gfkS2s)&&"function"==typeof window.gfkS2s.scb&&window.gfkS2s.scb(e),l.output("SUI SET: "+t.sui,"log")}},{key:"determineDeviceType",value:function(t,e){var n="";return e.match(/Linux/i)&&t.match(/(WEBOS)/i)&&(n="Smart-TV"),n}},{key:"determineOs",value:function(t,e){var n="";return e.match(/Linux /i)&&t.match(/WEBOS/i)&&(n="WebOS"),n}},{key:"getPlatform",value:function(){return t.isWebContext()?window.navigator.platform:""}},{key:"getOperatingSystem",value:function(){var e=t.getUserAgent(),n=t.getPlatform();return t.determineOs(e,n)}},{key:"getParticularDeviceType",value:function(){var e=t.getUserAgent(),n=t.getPlatform();return t.determineDeviceType(e,n)}},{key:"getUserAgent",value:function(){return t.isWebContext()?window.navigator.userAgent:""}},{key:"getTimeOffset",value:function(){return t.timeOffset}},{key:"getTimeWithOffset",value:function(){return t.getUTCTimeStamp()+t.getTimeOffset()}},{key:"checkDnt",value:function(){if(t.isDntEnabled()&&t.isWebContext()){var e=window.navigator;return"1"===(e.msDoNotTrack||window.doNotTrack||e.doNotTrack)}return!1}},{key:"setTimeOffset",value:function(){"idle"!==t.dateStatus&&"canceled"!==t.dateStatus||(t.dateStatus="waiting",t.getServerDate())}},{key:"isDntEnabled",value:function(){return t.config.dnt}},{key:"setConfig",value:function(e){t.isHttp()&&["tsUrl","trackingUrl"].forEach((function(t){window.s2sSdkConfig[t]=window.s2sSdkConfig[t].replace(/^https:/,"http:")})),t.config=e}},{key:"loadSUI",value:function(n,i,r,o){return h(this,void 0,void 0,e().mark((function s(){return e().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t.suiapiV1=i,t.suiapiV2=r,t.suiLoadedCallback=o,t.tagConf=n,"undefined"!=typeof document){e.next=6;break}return e.abrupt("return");case 6:try{t.fetchSui()}catch(e){l.output("".concat(e," Use empty SUI"),"error"),t.setSui(void 0)}case 7:case"end":return e.stop()}}),s)})))}},{key:"isSuiEmpty",value:function(){return""===t.sui}},{key:"getSui",value:function(){return t.sui}},{key:"getInstanceID",value:function(){return t.instanceid}},{key:"getServerDate",value:function(){window.top.addEventListener("message",(function(e){e.data.relayRequestServerDate&&"finished"!==t.dateStatus&&"canceled"!==t.dateStatus&&(t.dateStatus="finished",t.setCalculatedOffset(e.data.relayRequestServerDate))})),setTimeout((function(){"finished"!==t.dateStatus&&(t.dateStatus="canceled",l.output("Request Timeout!","warn"))}),3e3)}},{key:"setCalculatedOffset",value:function(e){var n=t.getUTCTimeStamp(),i=Date.parse(e);t.timeOffset=isNaN(i)?0:i-n,0!==t.timeOffset&&l.output("Time offset = "+t.timeOffset+" milliseconds","info")}},{key:"getUTCTimeStamp",value:function(){return(new Date).getTime()}},{key:"fetchSui",value:function(){var e=t.tagConf.hasOwnProperty("ai")?t.tagConf.ai:"",n=t.getOperatingSystem(),i=t.getParticularDeviceType(),r={optin:t.tagConf.optin,m:"1",ai:t.checkDnt()?"":e,o:n,dt:i,t:"s2s-w"};new Promise((function(e){t.suiapiV1.init((function(n){t.setSui(n),e(n)}),r)})).then((function(e){new Promise((function(e){t.suiapiV2.init((function(n){t.instanceid=n.id,e(n)}),r)})).then((function(){t.suiLoadedCallback&&t.suiLoadedCallback(e)}))}))}},{key:"isWebContext",value:function(){return"undefined"!=typeof window}},{key:"isHttp",value:function(){if("undefined"!=typeof window){if(window.document.currentScript){var t=window.document.currentScript;if(t.src)return t.src.match(/^http:/)}for(var e=document.getElementsByTagName("script"),n=0;n<e.length;n++)if(e[n]&&e[n].src.match(/\/s2s-web.js$/))return null!==e[n].src.match(/^http:/);if("http:"===window.location.protocol)return!0}return!1}}]),t}();d.suiLoadedCallback=null,d.sui="",d.instanceid="",d.dateStatus="idle",d.timeOffset=0;var v=function(){function t(){i(this,t)}return a(t,null,[{key:"validateTagConfig",value:function(t){var e="gfkS2sConf = {...}";if(!this.isStringAndNotEmpty(t.media,"mediaId",e))throw new Error;if(!this.isStringAndNotEmpty(t.url,"url",e))throw new Error;if(!this.isStringAndNotEmpty(t.type,"type",e))throw new Error;switch(t.type){case"APP":if(!this.isStringAndNotEmpty(t.device,"device",e))throw this.errorLog(e,"device","","Missing or empty property","error"),new Error;if(!t.hasOwnProperty("ai"))throw this.errorLog(e,"ai","","Missing property","error"),new Error;-1===["SMARTPHONE","TABLET","TV","DESKTOP"].indexOf(t.device)&&(this.errorLog(e,"device",t.device,"Unknown device type, see documentation","warn"),t.device="UNKNOWN");break;case"WEB":t.hasOwnProperty("visUrl")||l.output("Visibility disabled (no visUrl provided)","info");break;case"TV":break;default:throw this.errorLog(e,"type",t.type,"Unknown app type, see documentation (configuration)","error"),new Error("Unknown type")}}},{key:"isStringAndNotEmpty",value:function(t,e,n,i){var r="string"==typeof t&&t.length>0;return!1===r&&this.errorLog(n,e,t,"is not a string",i),r}},{key:"isCorrectStreamOffset",value:function(t,e,n,i){var r="number"==typeof t&&t>=0;return r||this.errorLog(n,e,t,"is not a positive number!",i),r}},{key:"isCorrectStreamStart",value:function(t,e,n,i){var r=Date.parse(t);return!isNaN(r)||0===t.length||(this.errorLog(n,e,t,"must be a valid date string with timezone offset (YYYY-MM-DDTHH:ii:ss TZ +OFFSET)!",i),!1)}},{key:"areParameterValid",value:function(t){for(var e in t)if(t.hasOwnProperty(e)&&!1===t[e])return l.output('Input param "'.concat(e,"\" is not valid, request couldn't be sent!"),"warn"),!1;return!0}},{key:"isPlayOptionsValid",value:function(t,e,n,i){var r=!0;if("object"!==o(t))this.errorLog(n,e,"(valueType="+o(t)+")","is invalid object!","warn"),r=!1;else{void 0===t.screen||"string"==typeof t.screen||(this.errorLog(n,e+".screen","(valueType="+o(t.screen)+")","is invalid object!","warn"),r=!1),void 0!==t.volume&&"string"!=typeof t.volume&&(r=!1),"string"==typeof t.speed&&isNaN(parseFloat(t.speed))&&(r=!1);var s=void 0===t.position;i&&(s=s||"number"==typeof t.position),s||(this.errorLog(n,e+".position","(valueType="+o(t.position)+")","is invalid object!","warn"),r=!1)}return r}},{key:"areCustomParametersValid",value:function(t,e,n){var i="object"===o(t);return!1===i&&this.errorLog(n,e,"(valueType="+o(t)+")","is invalid object!","warn"),i}},{key:"checkArgCount",value:function(e,n,i){if(!t.isArgumentsLengthValid(e,n,i))throw new Error(i+" cannot be executed!")}},{key:"isArgumentsLengthValid",value:function(t,e,n,i){return!1!=(t===e)||(this.errorLog(n,"Input parameter number",t.toString(),"; Invalid number of arguments, given: "+t+", expected: "+e+"!",i),!1)}},{key:"errorLog",value:function(t,e,n,i){var r=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"error";l.output("Origin="+t+"; Parameter="+e+"; Value="+n+"; "+i,r)}}]),t}();function m(t,e){return(m=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}function p(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&m(t,e)}function y(t,e){return!e||"object"!==o(e)&&"function"!=typeof e?function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t):e}function g(t){return(g=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}var b=function(){function t(e,n){i(this,t),this.sMediaId=e,this.sInstance=n}return a(t,[{key:"mediaId",get:function(){return this.sMediaId}},{key:"instance",get:function(){return this.sInstance}}]),t}();function k(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}();return function(){var n,i=g(t);if(e){var r=g(this).constructor;n=Reflect.construct(i,arguments,r)}else n=i.apply(this,arguments);return y(this,n)}}var S=function(t){p(n,t);var e=k(n);function n(t,r,o,s,a,u,c,l){var f;return i(this,n),(f=e.call(this,t,l)).iStreamPosition=r,f.sPresentationId=o,f.iStateItemNumber=s,f.iSegmentNumber=a,f.iSegmentDuration=u,f.iUsageTime=c,f}return a(n,[{key:"presentationId",get:function(){return this.sPresentationId}},{key:"stateItemNumber",get:function(){return this.iStateItemNumber}},{key:"segmentNumber",get:function(){return this.iSegmentNumber}},{key:"segmentDuration",get:function(){return this.iSegmentDuration}},{key:"streamPosition",get:function(){return this.iStreamPosition}},{key:"usageTime",get:function(){return this.iUsageTime}}]),n}(b),w=function(){function t(){i(this,t)}return a(t,null,[{key:"playbackSpeedConverter",value:function(t){if("string"!=typeof t||""===t||isNaN(parseFloat(t))){if("number"==typeof t)return Number(t.toFixed(2).replace(/(\.0+|0+)$/,""));if(void 0===t||""===t||null===t)return 1;throw new Error("Error in start event: Playback Speed wrong format. No data will be send")}return Number(Number(t).toFixed(2).replace(/(\.0+|0+)$/,""))}}]),t}();function P(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}();return function(){var n,i=g(t);if(e){var r=g(this).constructor;n=Reflect.construct(i,arguments,r)}else n=i.apply(this,arguments);return y(this,n)}}var I=function(t){p(n,t);var e=P(n);function n(t,r,o,s,a,u,c,l,f,h,d,v,m,p){var y;i(this,n);var g="ondemand"===d?o:-1;return(y=e.call(this,t,g,c,f,l,h,u,n.instance)).fPlaybackSpeedMultiplier=w.playbackSpeedConverter(v.speed),y.sPlayType=d,y.sContentId=r,y.oOptions=v,y.sVisibility=m||"",y.oCustomParams=p||{},y.iStreamStartTime=0===s.length?u-a:Date.parse(s)-a,y}return a(n,[{key:"playType",get:function(){return this.sPlayType},set:function(t){this.sPlayType=t}},{key:"contentId",get:function(){return this.sContentId}},{key:"options",get:function(){return this.oOptions}},{key:"visibility",get:function(){return this.sVisibility}},{key:"customParams",get:function(){return this.oCustomParams}},{key:"streamStartTime",get:function(){return this.iStreamStartTime}}]),n}(S);function E(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}();return function(){var n,i=g(t);if(e){var r=g(this).constructor;n=Reflect.construct(i,arguments,r)}else n=i.apply(this,arguments);return y(this,n)}}I.instance="EventPlay";var R=function(t){p(n,t);var e=E(n);function n(t,r,o,s,a,u,c){return i(this,n),e.call(this,t,r,o,a,s,u,c,n.instance)}return n}(S);function C(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}();return function(){var n,i=g(t);if(e){var r=g(this).constructor;n=Reflect.construct(i,arguments,r)}else n=i.apply(this,arguments);return y(this,n)}}R.instance="EventStop";var T=function(t){p(n,t);var e=C(n);function n(t,r,o,s,a,u,c){return i(this,n),e.call(this,t,r,o,a,s,u,c,n.instance)}return n}(S);function O(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}();return function(){var n,i=g(t);if(e){var r=g(this).constructor;n=Reflect.construct(i,arguments,r)}else n=i.apply(this,arguments);return y(this,n)}}T.instance="EventSkip";var x=function(t){p(n,t);var e=O(n);function n(t,r,o,s,a,u,c,l){var f;return i(this,n),(f=e.call(this,t,r,o,a,s,u,l,n.instance)).sVolume=c,f}return a(n,[{key:"volume",get:function(){return this.sVolume}}]),n}(S);function N(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}();return function(){var n,i=g(t);if(e){var r=g(this).constructor;n=Reflect.construct(i,arguments,r)}else n=i.apply(this,arguments);return y(this,n)}}x.instance="EventVolume";var A=function(t){p(n,t);var e=N(n);function n(t,r,o,s,a,u,c,l){var f;return i(this,n),(f=e.call(this,t,r,o,a,s,u,l,n.instance)).sScreen=c,f}return a(n,[{key:"screen",get:function(){return this.sScreen}}]),n}(S);function D(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}();return function(){var n,i=g(t);if(e){var r=g(this).constructor;n=Reflect.construct(i,arguments,r)}else n=i.apply(this,arguments);return y(this,n)}}A.instance="EventScreen";var L=function(t){p(n,t);var e=D(n);function n(t,r,o,s,a,u,c){return i(this,n),e.call(this,t,r,o,a,s,u,c,n.instance)}return n}(S);function V(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}();return function(){var n,i=g(t);if(e){var r=g(this).constructor;n=Reflect.construct(i,arguments,r)}else n=i.apply(this,arguments);return y(this,n)}}L.instance="EventHeartbeat";var H=function(t){p(n,t);var e=V(n);function n(t,r,o){var s;return i(this,n),(s=e.call(this,t,n.instance)).sContentId=r,s.oCustomParams=o||{},s}return a(n,[{key:"contentId",get:function(){return this.sContentId}},{key:"customParams",get:function(){return this.oCustomParams}}]),n}(b);function U(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}();return function(){var n,i=g(t);if(e){var r=g(this).constructor;n=Reflect.construct(i,arguments,r)}else n=i.apply(this,arguments);return y(this,n)}}H.instance="EventImpression";var M=function(t){p(n,t);var e=U(n);function n(t,r,o,s,a,u,c,l){var f;return i(this,n),(f=e.call(this,t,r,o,a,s,u,l,n.instance)).sVisibility=c,f}return a(n,[{key:"visibility",get:function(){return this.sVisibility}}]),n}(S);M.instance="EventVisibility";var B=function(){function t(e){i(this,t),this.mediaId=e}return a(t,[{key:"buildEventImpression",value:function(t,e){return new H(this.mediaId,t,e)}},{key:"buildEventPlay",value:function(t,e,n,i,r,o,s,a,u){return new I(this.mediaId,r,t.streamPosition,e,n,i,t.presentationId,t.segmentNumber,t.stateItemNumber,t.segmentDuration,o,s,a,u)}},{key:"buildEventStop",value:function(t,e){return new R(this.mediaId,t.streamPosition,t.presentationId,t.segmentNumber,t.stateItemNumber,t.segmentDuration,e)}},{key:"buildEventSkip",value:function(t,e){return new T(this.mediaId,t.streamPosition,t.presentationId,t.segmentNumber,t.stateItemNumber,t.segmentDuration,e)}},{key:"buildEventVolume",value:function(t,e,n){return new x(this.mediaId,t.streamPosition,t.presentationId,t.segmentNumber,t.stateItemNumber,t.segmentDuration,e,n)}},{key:"buildEventScreen",value:function(t,e,n){return new A(this.mediaId,t.streamPosition,t.presentationId,t.segmentNumber,t.stateItemNumber,t.segmentDuration,e,n)}},{key:"buildEventHeartbeat",value:function(t,e){return new L(this.mediaId,t.streamPosition,t.presentationId,t.segmentNumber,t.stateItemNumber,t.segmentDuration,e)}},{key:"buildEventVisibility",value:function(t,e,n){return new M(this.mediaId,t.streamPosition,t.presentationId,t.segmentNumber,t.stateItemNumber,t.segmentDuration,e,n)}}]),t}(),q=function(){function t(e,n,r,o,s){i(this,t),this.iStateItemNumber=e,this.iSegmentNumber=n,this.iStreamPosition=r,this.sPresentationId=o,this.iSegmentDuration=s}return a(t,[{key:"presentationId",get:function(){return this.sPresentationId}},{key:"segmentNumber",get:function(){return this.iSegmentNumber}},{key:"stateItemNumber",get:function(){return this.iStateItemNumber}},{key:"segmentDuration",get:function(){return this.iSegmentDuration}},{key:"streamPosition",get:function(){return this.iStreamPosition}}]),t}(),_=function(){function t(){i(this,t)}return a(t,[{key:"hash",value:function(t){var e,n,i,r,o,s,a,u,c,l;for(t=this.Utf8Encode(t),e=this.ConvertToWordArray(t),a=1732584193,u=4023233417,c=2562383102,l=271733878,n=0;n<e.length;n+=16)i=a,r=u,o=c,s=l,a=this.FF(a,u,c,l,e[n+0],7,3614090360),l=this.FF(l,a,u,c,e[n+1],12,3905402710),c=this.FF(c,l,a,u,e[n+2],17,606105819),u=this.FF(u,c,l,a,e[n+3],22,3250441966),a=this.FF(a,u,c,l,e[n+4],7,4118548399),l=this.FF(l,a,u,c,e[n+5],12,1200080426),c=this.FF(c,l,a,u,e[n+6],17,2821735955),u=this.FF(u,c,l,a,e[n+7],22,4249261313),a=this.FF(a,u,c,l,e[n+8],7,1770035416),l=this.FF(l,a,u,c,e[n+9],12,2336552879),c=this.FF(c,l,a,u,e[n+10],17,4294925233),u=this.FF(u,c,l,a,e[n+11],22,2304563134),a=this.FF(a,u,c,l,e[n+12],7,1804603682),l=this.FF(l,a,u,c,e[n+13],12,4254626195),c=this.FF(c,l,a,u,e[n+14],17,2792965006),u=this.FF(u,c,l,a,e[n+15],22,1236535329),a=this.GG(a,u,c,l,e[n+1],5,4129170786),l=this.GG(l,a,u,c,e[n+6],9,3225465664),c=this.GG(c,l,a,u,e[n+11],14,643717713),u=this.GG(u,c,l,a,e[n+0],20,3921069994),a=this.GG(a,u,c,l,e[n+5],5,3593408605),l=this.GG(l,a,u,c,e[n+10],9,38016083),c=this.GG(c,l,a,u,e[n+15],14,3634488961),u=this.GG(u,c,l,a,e[n+4],20,3889429448),a=this.GG(a,u,c,l,e[n+9],5,568446438),l=this.GG(l,a,u,c,e[n+14],9,3275163606),c=this.GG(c,l,a,u,e[n+3],14,4107603335),u=this.GG(u,c,l,a,e[n+8],20,1163531501),a=this.GG(a,u,c,l,e[n+13],5,2850285829),l=this.GG(l,a,u,c,e[n+2],9,4243563512),c=this.GG(c,l,a,u,e[n+7],14,1735328473),u=this.GG(u,c,l,a,e[n+12],20,2368359562),a=this.HH(a,u,c,l,e[n+5],4,4294588738),l=this.HH(l,a,u,c,e[n+8],11,2272392833),c=this.HH(c,l,a,u,e[n+11],16,1839030562),u=this.HH(u,c,l,a,e[n+14],23,4259657740),a=this.HH(a,u,c,l,e[n+1],4,2763975236),l=this.HH(l,a,u,c,e[n+4],11,1272893353),c=this.HH(c,l,a,u,e[n+7],16,4139469664),u=this.HH(u,c,l,a,e[n+10],23,3200236656),a=this.HH(a,u,c,l,e[n+13],4,681279174),l=this.HH(l,a,u,c,e[n+0],11,3936430074),c=this.HH(c,l,a,u,e[n+3],16,3572445317),u=this.HH(u,c,l,a,e[n+6],23,76029189),a=this.HH(a,u,c,l,e[n+9],4,3654602809),l=this.HH(l,a,u,c,e[n+12],11,3873151461),c=this.HH(c,l,a,u,e[n+15],16,530742520),u=this.HH(u,c,l,a,e[n+2],23,3299628645),a=this.II(a,u,c,l,e[n+0],6,4096336452),l=this.II(l,a,u,c,e[n+7],10,1126891415),c=this.II(c,l,a,u,e[n+14],15,2878612391),u=this.II(u,c,l,a,e[n+5],21,4237533241),a=this.II(a,u,c,l,e[n+12],6,1700485571),l=this.II(l,a,u,c,e[n+3],10,2399980690),c=this.II(c,l,a,u,e[n+10],15,4293915773),u=this.II(u,c,l,a,e[n+1],21,2240044497),a=this.II(a,u,c,l,e[n+8],6,1873313359),l=this.II(l,a,u,c,e[n+15],10,4264355552),c=this.II(c,l,a,u,e[n+6],15,2734768916),u=this.II(u,c,l,a,e[n+13],21,1309151649),a=this.II(a,u,c,l,e[n+4],6,4149444226),l=this.II(l,a,u,c,e[n+11],10,3174756917),c=this.II(c,l,a,u,e[n+2],15,718787259),u=this.II(u,c,l,a,e[n+9],21,3951481745),a=this.AddUnsigned(a,i),u=this.AddUnsigned(u,r),c=this.AddUnsigned(c,o),l=this.AddUnsigned(l,s);return(this.WordToHex(a)+this.WordToHex(u)+this.WordToHex(c)+this.WordToHex(l)).toLowerCase()}},{key:"RotateLeft",value:function(t,e){return t<<e|t>>>32-e}},{key:"AddUnsigned",value:function(t,e){var n=2147483648&t,i=2147483648&e,r=1073741824&t,o=1073741824&e,s=(1073741823&t)+(1073741823&e);return r&o?2147483648^s^n^i:r|o?1073741824&s?3221225472^s^n^i:1073741824^s^n^i:s^n^i}},{key:"F",value:function(t,e,n){return t&e|~t&n}},{key:"G",value:function(t,e,n){return t&n|e&~n}},{key:"H",value:function(t,e,n){return t^e^n}},{key:"I",value:function(t,e,n){return e^(t|~n)}},{key:"FF",value:function(t,e,n,i,r,o,s){return t=this.AddUnsigned(t,this.AddUnsigned(this.AddUnsigned(this.F(e,n,i),r),s)),this.AddUnsigned(this.RotateLeft(t,o),e)}},{key:"GG",value:function(t,e,n,i,r,o,s){return t=this.AddUnsigned(t,this.AddUnsigned(this.AddUnsigned(this.G(e,n,i),r),s)),this.AddUnsigned(this.RotateLeft(t,o),e)}},{key:"HH",value:function(t,e,n,i,r,o,s){return t=this.AddUnsigned(t,this.AddUnsigned(this.AddUnsigned(this.H(e,n,i),r),s)),this.AddUnsigned(this.RotateLeft(t,o),e)}},{key:"II",value:function(t,e,n,i,r,o,s){return t=this.AddUnsigned(t,this.AddUnsigned(this.AddUnsigned(this.I(e,n,i),r),s)),this.AddUnsigned(this.RotateLeft(t,o),e)}},{key:"ConvertToWordArray",value:function(t){for(var e,n=t.length,i=n+8,r=16*((i-i%64)/64+1),o=Array(r-1),s=0,a=0;a<n;)s=a%4*8,o[e=(a-a%4)/4]=o[e]|t.charCodeAt(a)<<s,a++;return s=a%4*8,o[e=(a-a%4)/4]=o[e]|128<<s,o[r-2]=n<<3,o[r-1]=n>>>29,o}},{key:"WordToHex",value:function(t){var e,n="",i="";for(e=0;e<=3;e++)n+=(i="0"+(t>>>8*e&255).toString(16)).substr(i.length-2,2);return n}},{key:"Utf8Encode",value:function(t){t=t.replace(/\r\n/g,"\n");for(var e="",n=0;n<t.length;n++){var i=t.charCodeAt(n);i<128?e+=String.fromCharCode(i):i>127&&i<2048?(e+=String.fromCharCode(i>>6|192),e+=String.fromCharCode(63&i|128)):(e+=String.fromCharCode(i>>12|224),e+=String.fromCharCode(i>>6&63|128),e+=String.fromCharCode(63&i|128))}return e}}]),t}(),F=function(){function t(e){i(this,t),this.milliseconds=1e3,this.minSegmentDuration=0,this.maxStateItemsNumber=0,this.maxSegmentNumber=0,this.state=1,this.presentationId="",this.streamId="",this.stateItemNumber=0,this.segmentNumber=0,this.playStreamPosition=0,this.streamOffset=0,this.startTime=0,this.toleranceSeconds=3,this.playbackSpeed=1,this.minSegmentDuration=e.minSegmentDuration,this.maxStateItemsNumber=e.maxSegmentStateItems,this.maxSegmentNumber=e.maxSegments,this.md5=new _}return a(t,[{key:"isSegmentStopped",value:function(){return 1===this.state}},{key:"createSegmentStarting",value:function(t,e,n,i,r){if(this.isMaxStateItemNumberReached()||this.isMaxSegmentNumberReached())throw new Error("Max state item number or max segment number reached!");return this.startTime=this.getTimeSeconds(),this.setSegmentAsPlayed(),this.playbackSpeed=i,this.playType=r,this.generateStreamSegment(t,e,n),this.incrementStateItemNumber(),this.incrementSegmentNumber(),this.createSegment(0,n)}},{key:"createSegmentRunning",value:function(t,e){if(this.isSegmentStopped()||this.isMaxStateItemNumberReached())throw new Error("Stream not yet started or max state item number reached!");var n=this.calculateSegmentDuration(t);if(e&&this.isBelowMinSegmentDuration(n))throw new Error("Duration of ".concat(n," ms is below min segment duration of ").concat(this.minSegmentDuration," ms!"));return this.checkSegmentDuration(n),this.incrementStateItemNumber(),this.createSegment(n,t)}},{key:"createSegmentStopping",value:function(t){if(this.isSegmentStopped())throw new Error("Stop called for an already stopped segment");this.setSegmentAsStopped();var e=this.calculateSegmentDuration(t);if(this.isBelowMinSegmentDuration(e))throw new Error("Duration of ".concat(e," ms is below min segment duration of ").concat(this.minSegmentDuration," ms!"));return this.checkSegmentDuration(e),this.incrementStateItemNumber(),this.createSegment(e,t)}},{key:"setStartTime",value:function(t){this.startTime=t}},{key:"setToleranceLimit",value:function(t){this.toleranceSeconds=t}},{key:"checkSegmentDuration",value:function(t){var e=this.getTimeSeconds()-this.startTime+this.toleranceSeconds;if(Math.round(t/1e3)>e*this.playbackSpeed)throw new Error("Segment duration  (".concat(t,") >= actual elapsed time (").concat(e," with playback speed ").concat(this.playbackSpeed,") !"))}},{key:"isBelowMinSegmentDuration",value:function(t){return t<this.minSegmentDuration}},{key:"isMaxStateItemNumberReached",value:function(){return this.maxStateItemsNumber<this.getStateItemNumber()}},{key:"isMaxSegmentNumberReached",value:function(){return this.maxSegmentNumber<this.getSegmentNumber()}},{key:"getTimeSeconds",value:function(){return Math.round(this.getTimeMilliseconds()/this.milliseconds)}},{key:"getTimeMilliseconds",value:function(){return Date.now()}},{key:"setSegmentAsPlayed",value:function(){this.state=0}},{key:"setSegmentAsStopped",value:function(){this.state=1}},{key:"getPresentationId",value:function(){return this.presentationId}},{key:"calculateDuration",value:function(t){return"live"===this.playType?Math.round(t*this.playbackSpeed):t}},{key:"calculateSegmentDuration",value:function(t){var e=this.getCurrentStreamPosition(t)-this.playStreamPosition;return this.calculateDuration(e)}},{key:"getCurrentStreamPosition",value:function(t){return t-this.streamOffset}},{key:"getStateItemNumber",value:function(){return this.stateItemNumber}},{key:"getSegmentNumber",value:function(){return this.segmentNumber}},{key:"incrementStateItemNumber",value:function(){this.stateItemNumber++}},{key:"incrementSegmentNumber",value:function(){this.segmentNumber++}},{key:"generateStreamSegment",value:function(t,e,n){this.isStreamIdChanged(e)&&(this.streamId=e,this.presentationId=this.generatePresentationId(e),this.stateItemNumber=0,this.segmentNumber=0),this.streamOffset=t,this.playStreamPosition=this.getCurrentStreamPosition(n)}},{key:"isStreamIdChanged",value:function(t){return this.streamId!==t}},{key:"generatePresentationId",value:function(t){var e=this.getRndInt(1e6,9999999);return this.md5.hash(t).toUpperCase()+e+this.getTimeMilliseconds()}},{key:"getRndInt",value:function(t,e){return t=Math.ceil(t),e=Math.floor(e),Math.floor(Math.random()*(e-t+1))+t}},{key:"createSegment",value:function(t,e){return new q(this.getStateItemNumber(),this.getSegmentNumber(),this.getCurrentStreamPosition(e),this.getPresentationId(),t)}}]),t}(),j=function(){function t(e){i(this,t),this.requestType=e,this.fields={ty:e}}return a(t,[{key:"projectId",set:function(t){this.fields.p=t}},{key:"mediaId",set:function(t){this.fields.m=t}},{key:"technology",set:function(t){this.fields.t=t}},{key:"version",set:function(t){this.fields.v=t}},{key:"operatingSystem",set:function(t){this.fields.os=t}},{key:"appType",set:function(t){this.fields.at=t}},{key:"deviceType",get:function(){return this.fields.dt},set:function(t){this.fields.dt=t}},{key:"getAsUrlString",value:function(){var t="";for(var e in this.fields)if(this.fields.hasOwnProperty(e)){var n=this.fields[e];"object"===o(n)&&(n=JSON.stringify(n)),t+=e+"="+this.encode(n)+"&"}return t.substring(0,t.length-1)}},{key:"customParameter",set:function(t){var e=t.userParams,n=t.allowedParams;for(var i in e)e.hasOwnProperty(i)&&-1!==n.indexOf(i)&&(this.fields["cp_"+i]=e[i])}},{key:"encode",value:function(t){return encodeURIComponent(t)}}]),t}();function G(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}();return function(){var n,i=g(t);if(e){var r=g(this).constructor;n=Reflect.construct(i,arguments,r)}else n=i.apply(this,arguments);return y(this,n)}}var W=function(t){p(n,t);var e=G(n);function n(t){return i(this,n),e.call(this,t)}return a(n,[{key:"presentationId",get:function(){return this.fields.pr},set:function(t){this.fields.pr=t}},{key:"requestNumber",set:function(t){this.fields.rn=t.toString()}},{key:"segmentNumber",get:function(){return parseInt(this.fields.sn,10)},set:function(t){this.fields.sn=t.toString()}},{key:"segmentDuration",set:function(t){this.fields.sd=Math.round(t/1e3).toString(),this.fields.vt=this.fields.sd}},{key:"streamTime",set:function(t){this.fields.st=Math.round(t/1e3).toString(),this.fields.ct=this.fields.st}},{key:"usageTime",set:function(t){this.fields.ut=Math.round(t/1e3).toString()}}]),n}(j);function K(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}();return function(){var n,i=g(t);if(e){var r=g(this).constructor;n=Reflect.construct(i,arguments,r)}else n=i.apply(this,arguments);return y(this,n)}}var X=function(t){p(n,t);var e=K(n);function n(){var t;return i(this,n),(t=e.call(this,"HB")).isMostRecent=!0,t}return n}(W);function Y(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}();return function(){var n,i=g(t);if(e){var r=g(this).constructor;n=Reflect.construct(i,arguments,r)}else n=i.apply(this,arguments);return y(this,n)}}var Q=function(t){p(n,t);var e=Y(n);function n(){return i(this,n),e.call(this,"PL")}return a(n,[{key:"contentId",set:function(t){this.fields.c=t}},{key:"streamPosition",set:function(t){this.fields.sp=-1===t?"-1":Math.round(t/1e3).toString(),this.fields.vp=this.fields.sp}},{key:"playbackSpeed",set:function(t){this.fields.ps=t.toString()}},{key:"visibility",set:function(t){this.fields.vb=t}},{key:"screen",set:function(t){this.fields.sc=t}},{key:"volume",set:function(t){this.fields.vo=t}},{key:"sui",set:function(t){this.fields.sui=t}},{key:"instanceid",set:function(t){this.fields.instanceid=t}},{key:"origin",set:function(t){this.fields.r=t}},{key:"userAgent",set:function(t){this.fields.ua=t}},{key:"language",set:function(t){this.fields.l=t}}]),n}(W);function J(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}();return function(){var n,i=g(t);if(e){var r=g(this).constructor;n=Reflect.construct(i,arguments,r)}else n=i.apply(this,arguments);return y(this,n)}}var $=function(t){p(n,t);var e=J(n);function n(){return i(this,n),e.call(this,"SC")}return a(n,[{key:"screen",set:function(t){this.fields.sc=t}}]),n}(W);function z(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}();return function(){var n,i=g(t);if(e){var r=g(this).constructor;n=Reflect.construct(i,arguments,r)}else n=i.apply(this,arguments);return y(this,n)}}var Z=function(t){p(n,t);var e=z(n);function n(){return i(this,n),e.call(this,"ST")}return a(n,[{key:"skip",set:function(t){this.fields.sk=t.toString()}}]),n}(W);function tt(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}();return function(){var n,i=g(t);if(e){var r=g(this).constructor;n=Reflect.construct(i,arguments,r)}else n=i.apply(this,arguments);return y(this,n)}}var et=function(t){p(n,t);var e=tt(n);function n(){return i(this,n),e.call(this,"VO")}return a(n,[{key:"volume",set:function(t){this.fields.vo=t}}]),n}(W);function nt(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}();return function(){var n,i=g(t);if(e){var r=g(this).constructor;n=Reflect.construct(i,arguments,r)}else n=i.apply(this,arguments);return y(this,n)}}var it=function(t){p(n,t);var e=nt(n);function n(){return i(this,n),e.call(this,"IM")}return a(n,[{key:"contentId",set:function(t){this.fields.c=t}},{key:"sui",set:function(t){this.fields.sui=t}},{key:"instanceid",set:function(t){this.fields.instanceid=t}},{key:"origin",set:function(t){this.fields.r=t}},{key:"userAgent",set:function(t){this.fields.ua=t}},{key:"language",set:function(t){this.fields.l=t}}]),n}(j);function rt(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}();return function(){var n,i=g(t);if(e){var r=g(this).constructor;n=Reflect.construct(i,arguments,r)}else n=i.apply(this,arguments);return y(this,n)}}var ot=function(t){p(n,t);var e=rt(n);function n(){return i(this,n),e.call(this,"VB")}return a(n,[{key:"visibility",set:function(t){this.fields.vb=t}}]),n}(W),st=function(){function t(e){i(this,t),this.collector=e}return a(t,[{key:"buildRequest",value:function(t){var e;switch(t.instance){case"EventImpression":e=this.buildRequestImpression(t);break;case"EventPlay":e=this.buildRequestPlay(t);break;case"EventStop":e=this.buildRequestStop(t);break;case"EventSkip":e=this.buildRequestSkip(t);break;case"EventVolume":e=this.buildRequestVolume(t);break;case"EventScreen":e=this.buildRequestScreen(t);break;case"EventHeartbeat":e=this.buildRequestHeartbeat(t);break;case"EventVisibility":e=this.buildRequestVisibility(t)}return e}},{key:"buildRequestImpression",value:function(t){var e=this.buildRequestCommon(new it,t);return e.contentId=t.contentId,e.sui=d.getSui(),e.instanceid=d.getInstanceID(),e.userAgent=d.getUserAgent(),e.language=this.collector.getLanguage(),e.origin=this.collector.getOrigin(),e.customParameter={userParams:t.customParams,allowedParams:this.collector.getContentCustomParameter()},e}},{key:"buildRequestPlay",value:function(t){var e=this.buildRequestBase(new Q,t);return e.contentId=t.contentId,e.volume=t.options.volume||"",e.visibility=t.visibility,e.screen=t.options.screen||"",e.sui=d.getSui(),e.instanceid=d.getInstanceID(),e.userAgent=d.getUserAgent(),e.language=this.collector.getLanguage(),e.origin=this.collector.getOrigin(),e.streamPosition=t.streamPosition,e.streamTime=t.streamStartTime,e.playbackSpeed=w.playbackSpeedConverter(t.options.speed),e.customParameter={userParams:t.customParams,allowedParams:this.collector.getStreamCustomParameter()},e}},{key:"buildRequestStop",value:function(t){var e=this.buildRequestBase(new Z,t);return e.skip=0,e}},{key:"buildRequestSkip",value:function(t){var e=this.buildRequestBase(new Z,t);return e.skip=1,e}},{key:"buildRequestVolume",value:function(t){var e=this.buildRequestBase(new et,t);return e.volume=t.volume,e}},{key:"buildRequestScreen",value:function(t){var e=this.buildRequestBase(new $,t);return e.screen=t.screen,e}},{key:"buildRequestHeartbeat",value:function(t){return this.buildRequestBase(new X,t)}},{key:"buildRequestVisibility",value:function(t){var e=this.buildRequestBase(new ot,t);return e.visibility=t.visibility,e}},{key:"buildRequestBase",value:function(t,e){return(t=this.buildRequestCommon(t,e)).presentationId=e.presentationId,t.requestNumber=e.stateItemNumber,t.segmentNumber=e.segmentNumber,t.segmentDuration=e.segmentDuration,t.usageTime=e.usageTime,t}},{key:"buildRequestCommon",value:function(t,e){return t.projectId=this.collector.getProjectName(),t.mediaId=e.mediaId,t.technology=this.collector.getTechnology(),t.version=this.collector.getVersion(),t.operatingSystem=d.getOperatingSystem(),t.deviceType=this.getDeviceType(t.requestType),t.appType=this.collector.getAppType(),t}},{key:"getDeviceType",value:function(t){var e=this.lastDeviceType;return void 0!==e&&"PL"!==t||(e=this.lastDeviceType=this.collector.getDeviceType()),e}}]),t}(),at=function(){function t(e,n){i(this,t),this.eventBuilder=new B(e),this.segmentBuilder=new F(n.getSegmentSettings()),this.requestBuilder=new st(n)}return a(t,[{key:"getSegmentBuilder",value:function(){return this.segmentBuilder}},{key:"getEventBuilder",value:function(){return this.eventBuilder}},{key:"getRequestBuilder",value:function(){return this.requestBuilder}}]),t}(),ut=function(){function t(){i(this,t),this.fields={},this.fields.pjid="943913",this.fields.method="nodeId"}return a(t,[{key:"place",set:function(t){this.fields.place=t}},{key:"cb",set:function(t){this.fields.cb=t}},{key:"node",set:function(t){this.fields.node=t}},{key:"visreport",set:function(t){this.fields.visreport=t}},{key:"getAsUrlString",value:function(){var t="";for(var e in this.fields)if(this.fields.hasOwnProperty(e)){var n=this.fields[e];t+=e+"="+encodeURIComponent(n)+"&"}return t.substring(0,t.length-1)}}]),t}(),ct=function(){function t(e,n,r,o){i(this,t),this.state=1,this.visibilityValue="undefined",this.htmlPlayerId=e,this.customer=n,this.url=r,this.callback=o}return a(t,[{key:"setVisibility",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;0===this.state&&t!==this.visibilityValue&&(l.output("Visibility (".concat(this.htmlPlayerId,"): ").concat(t),"log"),this.callback(t,e)),this.visibilityValue=t}},{key:"getVisibility",value:function(){return l.output("Visibility (".concat(this.htmlPlayerId,"): ").concat(this.visibilityValue),"log"),this.visibilityValue}},{key:"activateVisibility",value:function(){var t=this;if(""!==this.htmlPlayerId){var e=("visreport_"+this.htmlPlayerId).replace(/[\W]+/gi,""),n=window;"function"!=typeof n[e]&&(n[e]=function(e){t.setVisibility(e)});var i=this.getParameter(this.htmlPlayerId,e);this.loadScript(n,i)}}},{key:"pause",value:function(){this.state=1}},{key:"resume",value:function(){this.state=0}},{key:"loadScript",value:function(t,e){var n=t.document.createElement("script"),i=t.document.getElementsByTagName("script")[0];n.type="text/javascript",n.src=this.url+"#"+e,n.async=!0,l.output("Visibility activated\n"+n.src,"log"),i.parentNode.insertBefore(n,i)}},{key:"getParameter",value:function(t,e){var n=new ut;return n.cb=(new Date).getTime().toString(),n.place=this.customer,n.node=t,n.visreport=e,n.getAsUrlString()}}]),t}();function lt(t,e){var n;if("undefined"==typeof Symbol||null==t[Symbol.iterator]){if(Array.isArray(t)||(n=function(t,e){if(!t)return;if("string"==typeof t)return ft(t,e);var n=Object.prototype.toString.call(t).slice(8,-1);"Object"===n&&t.constructor&&(n=t.constructor.name);if("Map"===n||"Set"===n)return Array.from(t);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return ft(t,e)}(t))||e&&t&&"number"==typeof t.length){n&&(t=n);var i=0,r=function(){};return{s:r,n:function(){return i>=t.length?{done:!0}:{done:!1,value:t[i++]}},e:function(t){throw t},f:r}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var o,s=!0,a=!1;return{s:function(){n=t[Symbol.iterator]()},n:function(){var t=n.next();return s=t.done,t},e:function(t){a=!0,o=t},f:function(){try{s||null==n.return||n.return()}finally{if(a)throw o}}}}function ft(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,i=new Array(e);n<e;n++)i[n]=t[n];return i}var ht=function(){function t(e,n){i(this,t),this.milliseconds=1e3,this.heartbeatNumber=0,this.intervalId=0,this.timeoutId=[],this.buildHeartbeat=e,this.heartbeatConfig=n,this.extendTimeoutIntervallWithParamsForOldIE()}return a(t,[{key:"start",value:function(){var t=this;if(this.stop(),this.isHeartbeatEnabled()&&!(this.heartbeatConfig.interval.length<1)&&"undefined"!=typeof window){this.heartbeatNumber=0;var e,n=this.heartbeatConfig.interval.slice(),i=n.pop(),r=0,o=lt(n);try{for(o.s();!(e=o.n()).done;){r+=e.value,this.timeoutId.push(window.setTimeout(this.buildHeartbeatEvent,r*this.milliseconds,this))}}catch(t){o.e(t)}finally{o.f()}r+=i,this.timeoutId.push(window.setTimeout((function(){t.buildHeartbeatEvent(t),t.intervalId=window.setInterval(t.buildHeartbeatEvent,i*t.milliseconds,t)}),r*this.milliseconds))}}},{key:"stop",value:function(){var t,e=lt(this.timeoutId);try{for(e.s();!(t=e.n()).done;){var n=t.value;clearTimeout(n)}}catch(t){e.e(t)}finally{e.f()}clearInterval(this.intervalId),this.timeoutId=[],this.intervalId=0}},{key:"isHeartbeatActive",value:function(){return this.intervalId>0}},{key:"getMaxHeartbeatInterval",value:function(){var t=0;return this.isHeartbeatEnabled()&&this.heartbeatConfig.interval.length>0&&(t=Math.max.apply(Math,this.heartbeatConfig.interval)),t}},{key:"buildHeartbeatEvent",value:function(t){t.isMaxHeartbeatReached()?t.stop():(t.heartbeatNumber++,t.buildHeartbeat())}},{key:"isHeartbeatEnabled",value:function(){return this.heartbeatConfig.enabled}},{key:"isMaxHeartbeatReached",value:function(){return 0!==this.heartbeatConfig.maximum&&this.heartbeatNumber>=this.heartbeatConfig.maximum}},{key:"extendTimeoutIntervallWithParamsForOldIE",value:function(){if("undefined"!=typeof window){if(document.all){var t=window.setTimeout;window.setTimeout=function(e,n){var i=this,r=Array.prototype.slice.call(arguments,2);return t(e instanceof Function?function(){e.apply(i,r)}:e,n)}}if(document.all){var e=window.setInterval;window.setInterval=function(t,n){var i=this,r=Array.prototype.slice.call(arguments,2);return e(t instanceof Function?function(){t.apply(i,r)}:t,n)}}}}}]),t}(),dt=function(){function t(e){i(this,t),this.timeWithOffsetCallback=e}return a(t,[{key:"setPlayType",value:function(t){this.playType=t}},{key:"setStreamPositionCallback",value:function(t){this.streamPositionCallback=t}},{key:"getCurrentStreamPosition",value:function(){var t=0;switch(this.playType){case"live":t=this.getCurrentStreamPositionLive();break;case"ondemand":t=this.getCurrentStreamPositionOnDemand()}return t}},{key:"getCurrentStreamPositionLive",value:function(){return this.timeWithOffsetCallback()}},{key:"getCurrentStreamPositionOnDemand",value:function(){var t=0;try{t=this.streamPositionCallback()}catch(t){throw new Error("Error while executing stream position callback: "+t.message)}if("number"!=typeof t||t<0)throw new Error("Stream position must be a positive milliseconds value, but is ".concat(t,"."));return l.output("Stream position: ".concat(l.formatDuration(t)," (").concat(t,")"),"log"),t}}]),t}(),vt=function(){function t(e){i(this,t),this.skipAllAfterValidationError=!1,this.lastPosition=0,this.heartbeat=e}return a(t,[{key:"start",value:function(t){if(t<0)throw this.skipAllAfterValidationError=!0,new Error("Position must be >= 0.");this.skipAllAfterValidationError=!1,this.lastPosition=t}},{key:"validate",value:function(t){if(this.skipAllAfterValidationError)throw new Error("Event skipped after validation error!");if(t<this.lastPosition)throw new Error("Current position (".concat(t,") is less than last position (").concat(this.lastPosition,")."));this.heartbeat.isHeartbeatActive()&&this.skipIfItemIntervalLargerThanHbInterval(t)}},{key:"updateLastPosition",value:function(t){this.lastPosition=t}},{key:"skipIfItemIntervalLargerThanHbInterval",value:function(e){var n=e-this.lastPosition,i=1e3*(this.heartbeat.getMaxHeartbeatInterval()+t.toleranceSeconds);if(n>i){this.heartbeat.stop(),this.skipAllAfterValidationError=!0;var r="Time interval since last segment is ".concat(n," ms, should be < ").concat(i," ms.");throw r+=" Last: ".concat(this.lastPosition,", current: ").concat(e,"."),l.output(r,"error"),new Error(r)}}}]),t}();vt.toleranceSeconds=300;var mt=function(){function t(){i(this,t),this.mostRecentHeartbeats={}}return a(t,[{key:"onNewHeartbeatGenerated",value:function(t){t.isMostRecent=!0,this.invalidateMostRecentHeartbeat(t),this.storeAsMostRecentHeartbeat(t)}},{key:"invalidateMostRecentHeartbeat",value:function(t){var e=t.presentationId,n=t.segmentNumber;this.mostRecentHeartbeats[e]&&this.mostRecentHeartbeats[e][n]&&(this.mostRecentHeartbeats[e][n].isMostRecent=!1)}},{key:"storeAsMostRecentHeartbeat",value:function(t){var e,n,i,r=t.presentationId,o=t.segmentNumber;this.mostRecentHeartbeats[r]=(i=t,(n=o)in(e={})?Object.defineProperty(e,n,{value:i,enumerable:!0,configurable:!0,writable:!0}):e[n]=i,e)}}]),t}(),pt=function(){function t(e){i(this,t),this.sendTo=e}return a(t,[{key:"send",value:function(t){var e,n=new Promise((function(t,n){e=function(e){return e?t():n("Sending request failed")}}));return this.isWebContext()?this.isIEContext()?this.sendWithOldIE(t,e):this.sendWithDefault(t,e):this.sendNotInBrowser(e),n}},{key:"sendWithDefault",value:function(t,e){if(XMLHttpRequest){var n=new XMLHttpRequest;if(!("withCredentials"in n))return l.output("withCredentials not possible on XMLHttpRequest","error"),void e(!1);n.open("POST",this.sendTo,!0),n.setRequestHeader("Content-Type","application/x-www-form-urlencoded"),n.onreadystatechange=function(){4===n.readyState&&(204===n.status?e(!0):e(!1))},n.send(t.getAsUrlString())}else l.output("XMLHttpRequest not found","error"),e(!1)}},{key:"sendWithOldIE",value:function(t,e){var n=new XDomainRequest;n.open("POST",this.sendTo),n.onerror=function(){l.output("Can't send a request with old IE","error"),e(!1)},n.ontimeout=function(){l.output("Server status unknown, POST data not sent!","error"),e(!1)},n.onload=function(){l.output(t.requestType,"log","request",t.fields),e(!0)},n.send(t.getAsUrlString())}},{key:"sendNotInBrowser",value:function(t){l.output("Cannot send xhttp request, not in a browser","warn"),t(!0)}},{key:"isWebContext",value:function(){return"undefined"!=typeof window}},{key:"isIEContext",value:function(){return"undefined"!=typeof XDomainRequest}}]),t}(),yt=function(t,e,n,i){return new(n||(n=Promise))((function(r,o){function s(t){try{u(i.next(t))}catch(t){o(t)}}function a(t){try{u(i.throw(t))}catch(t){o(t)}}function u(t){var e;t.done?r(t.value):(e=t.value,e instanceof n?e:new n((function(t){t(e)}))).then(s,a)}u((i=i.apply(t,e||[])).next())}))},gt=function(){function t(e){i(this,t),this.storage=[],this.currentDelay=t.BASE_DELAY,this.isResendQueued=!1,this.requestSender=new pt(e)}return a(t,[{key:"sendRequest",value:function(t){var e=this;return this.requestSender.send(t).then((function(){return l.output("Sent: "+t.requestType,"log","request",t.fields)})).catch((function(n){l.output("Failed to send request: "+n,"error"),bt(t)&&(l.output("Queueing request","info"),e.storage.push(t)),e.isResendQueued||(l.output("No re-sending active, starting new re-sending after "+e.currentDelay+" ms","info"),e.scheduleNextResend())}))}},{key:"resend",value:function(){return yt(this,void 0,void 0,e().mark((function n(){var i;return e().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!(this.storage.length>0)){e.next=17;break}return i=this.storage.shift(),e.prev=2,e.next=5,this.requestSender.send(i);case 5:e.next=15;break;case 7:return e.prev=7,e.t0=e.catch(2),bt(i)&&this.storage.unshift(i),this.increaseDelay(),l.output("Failed to re-send request: "+e.t0,"error"),l.output("Increasing re-send delay to "+this.currentDelay,"info"),this.scheduleNextResend(),e.abrupt("break",17);case 15:e.next=0;break;case 17:0===this.storage.length&&(l.output("All requests flushed","info"),this.isResendQueued=!1,this.currentDelay=t.BASE_DELAY);case 18:case"end":return e.stop()}}),n,this,[[2,7]])})))}},{key:"scheduleNextResend",value:function(){var t=this;setTimeout((function(){return t.resend()}),this.currentDelay),this.isResendQueued=!0}},{key:"increaseDelay",value:function(){this.currentDelay=Math.min(2*this.currentDelay,t.MAX_DELAY)}},{key:"_requestSender",get:function(){return this.requestSender}}]),t}();function bt(t){return!("HB"===t.requestType)||t.isMostRecent}gt.MAX_DELAY=32e3,gt.BASE_DELAY=500;var kt,St=function(){function t(e,n,r){var o=this;i(this,t),this.heartbeatInvalidator=new mt,this.htmlPlayerId=r,d.setConfig(n),this.collector=new d(e),this.streamPositionManager=new dt(d.getTimeWithOffset),this.visibility=new ct(this.htmlPlayerId,e.media,e.visUrl,(function(t){l.output("Triggered: VB","log","fcall",t),o.createEventVisibility(t)})),this.builder=new at(e.media,this.collector),this.transmitter=new gt(n.trackingUrl),this.heartbeat=new ht((function(){l.output("Triggered: HB","log","fcall"),o.createEventHeartbeat()}),n.heartbeat),this.itemValidator=new vt(this.heartbeat)}return a(t,[{key:"activateVisibility",value:function(){this.visibility.activateVisibility()}},{key:"setStreamPositionCallback",value:function(t){this.streamPositionManager.setStreamPositionCallback(t)}},{key:"isPlaying",value:function(){return!this.builder.getSegmentBuilder().isSegmentStopped()}},{key:"createEventImpression",value:function(t,e){try{var n=this.builder.getEventBuilder().buildEventImpression(t,e),i=this.builder.getRequestBuilder().buildRequest(n);this.send(i)}catch(t){l.output("Error in impression event: "+t.message,"error")}}},{key:"createEventPlayLive",value:function(t,e,n,i,r,o){try{this.streamPositionManager.setPlayType("live");var s=this.streamPositionManager.getCurrentStreamPosition();this.itemValidator.start(s);var a=this.builder.getSegmentBuilder().createSegmentStarting(n,i,s,w.playbackSpeedConverter(r.speed),"live");this.heartbeat.start(),this.visibility.resume();var u=d.getTimeWithOffset(),c=this.visibility.getVisibility(),f=this.builder.getEventBuilder().buildEventPlay(a,e,n,u,t,"live",r,c,o),h=this.builder.getRequestBuilder().buildRequest(f);this.send(h)}catch(t){l.output("Error in play (live) event: "+t.message,"error")}}},{key:"createEventPlayOnDemand",value:function(t,e,n,i){var r;try{this.streamPositionManager.setPlayType("ondemand");var o=null!==(r=n.position)&&void 0!==r?r:this.streamPositionManager.getCurrentStreamPosition();this.itemValidator.start(o);var s=this.builder.getSegmentBuilder().createSegmentStarting(0,e,o,w.playbackSpeedConverter(n.speed),"ondemand");this.heartbeat.start(),this.visibility.resume();var a=d.getTimeWithOffset(),u=this.visibility.getVisibility(),c=this.builder.getEventBuilder().buildEventPlay(s,"",0,a,t,"ondemand",n,u,i),f=this.builder.getRequestBuilder().buildRequest(c);this.send(f)}catch(t){l.output("Error in play (on demand) event: "+t.message,"error")}}},{key:"createEventStop",value:function(t){var e=!1;this.visibility.pause();try{var n=null!=t?t:this.streamPositionManager.getCurrentStreamPosition();this.itemValidator.validate(n);var i=this.builder.getSegmentBuilder().createSegmentStopping(n),r=d.getTimeWithOffset(),o=this.builder.getEventBuilder().buildEventStop(i,r),s=this.builder.getRequestBuilder().buildRequest(o);this.send(s),e=!0,this.itemValidator.updateLastPosition(n)}catch(t){l.output("Error in stop event: "+t.message,"error")}return this.heartbeat.stop(),e}},{key:"createEventSkip",value:function(t){var e=!1;this.visibility.pause();try{var n=null!=t?t:this.streamPositionManager.getCurrentStreamPosition();this.itemValidator.validate(n);var i=this.builder.getSegmentBuilder().createSegmentStopping(n),r=d.getTimeWithOffset(),o=this.builder.getEventBuilder().buildEventSkip(i,r),s=this.builder.getRequestBuilder().buildRequest(o);this.send(s),e=!0,this.itemValidator.updateLastPosition(n)}catch(t){l.output("Error in skip event: "+t.message,"error")}return this.heartbeat.stop(),e}},{key:"createEventHeartbeat",value:function(){try{var t=this.streamPositionManager.getCurrentStreamPosition();this.itemValidator.validate(t);var e=this.builder.getSegmentBuilder().createSegmentRunning(t,!0),n=d.getTimeWithOffset(),i=this.builder.getEventBuilder().buildEventHeartbeat(e,n),r=this.builder.getRequestBuilder().buildRequest(i);this.send(r),this.heartbeatInvalidator.onNewHeartbeatGenerated(r),this.itemValidator.updateLastPosition(t)}catch(t){l.output("Error in heartbeat event: "+t.message,"error")}}},{key:"createEventVisibility",value:function(t){try{var e=this.streamPositionManager.getCurrentStreamPosition();this.itemValidator.validate(e);var n=this.builder.getSegmentBuilder().createSegmentRunning(e,!1),i=d.getTimeWithOffset(),r=this.builder.getEventBuilder().buildEventVisibility(n,t,i),o=this.builder.getRequestBuilder().buildRequest(r);this.send(o),this.itemValidator.updateLastPosition(e)}catch(t){l.output("Error in visibility event: "+t.message,"error")}}},{key:"createEventScreen",value:function(t){try{var e=this.streamPositionManager.getCurrentStreamPosition();this.itemValidator.validate(e);var n=this.builder.getSegmentBuilder().createSegmentRunning(e,!0),i=d.getTimeWithOffset(),r=this.builder.getEventBuilder().buildEventScreen(n,t,i),o=this.builder.getRequestBuilder().buildRequest(r);this.send(o),this.itemValidator.updateLastPosition(e)}catch(t){l.output("Error in screen event: "+t.message,"error")}}},{key:"createEventVolume",value:function(t){try{var e=this.streamPositionManager.getCurrentStreamPosition();this.itemValidator.validate(e);var n=this.builder.getSegmentBuilder().createSegmentRunning(e,!0),i=d.getTimeWithOffset(),r=this.builder.getEventBuilder().buildEventVolume(n,t,i),o=this.builder.getRequestBuilder().buildRequest(r);this.send(o),this.itemValidator.updateLastPosition(e)}catch(t){l.output("Error in volume event: "+t.message,"error")}}},{key:"isProjectEnabled",value:function(){return!0===this.collector.getProjectStatus()}},{key:"send",value:function(t){this.isProjectEnabled()&&this.transmitter.sendRequest(t)}}]),t}(),wt=function(){function t(e,n,r,o){(i(this,t),v.validateTagConfig(e),void 0===o)&&(o=window.s2sSdkConfig);this.processor=new St(e,o,n),"function"==typeof r&&this.setStreamPositionCallback(r);o.visibilityEnabled?e.hasOwnProperty("visUrl")&&void 0!==n&&this.activateVisibility():l.output("Visibility disabled (disabled by config)","info")}return a(t,[{key:"impression",value:function(t,e){var n="impression()";l.output("Triggered: "+n,"log","fcall",arguments),v.checkArgCount(arguments.length,2,n);var i={contentId:v.isStringAndNotEmpty(t,"contentId",n),customParams:v.areCustomParametersValid(e,"customParams",n)},r=v.areParameterValid(i);return r&&this.processor.createEventImpression(t,e),i}},{key:"playStreamLive",value:function(t,e,n,i,r,o){var s="playStreamLive()";l.output("Triggered: "+s,"log","fcall",arguments),v.checkArgCount(arguments.length,6,s);var a={contentId:v.isStringAndNotEmpty(t,"contentId",s),streamStart:v.isCorrectStreamStart(e,"streamStart",s),streamOffset:v.isCorrectStreamOffset(n,"streamOffset",s),streamId:v.isStringAndNotEmpty(i,"streamId",s),options:v.isPlayOptionsValid(r,"options",s,!1),customParams:v.areCustomParametersValid(o,"customParams",s)},u=v.areParameterValid(a);return u&&this.processor.createEventPlayLive(t,e,n,i,r,o),a}},{key:"playLive",value:function(t,e,n,i,r,o,s){var a="playLive()";v.checkArgCount(arguments.length,7,a);var u={screen:r,volume:o};return this.playStreamLive(t,e,n,i,u,s)}},{key:"playStreamOnDemand",value:function(t,e,n,i,r){var o,s="playStreamOnDemand()";if(l.output("Triggered: "+s,"log","fcall",arguments),"number"==typeof n){v.checkArgCount(arguments.length,5,s);var a=Object.assign(Object.assign({},i),{position:n}),u=r;o={contentId:v.isStringAndNotEmpty(t,"contentId",s),streamId:v.isStringAndNotEmpty(e,"streamId",s),options:v.isPlayOptionsValid(a,"options",s,!0),customParams:v.areCustomParametersValid(u,"customParams",s)};var c=v.areParameterValid(o);c&&this.processor.createEventPlayOnDemand(t,e,a,u)}else{v.checkArgCount(arguments.length,4,s);var f=n,h=i;o={contentId:v.isStringAndNotEmpty(t,"contentId",s),streamId:v.isStringAndNotEmpty(e,"streamId",s),options:v.isPlayOptionsValid(f,"options",s,!0),customParams:v.areCustomParametersValid(h,"customParams",s)};var d=v.areParameterValid(o);d&&this.processor.createEventPlayOnDemand(t,e,f,h)}return o}},{key:"playVOD",value:function(t,e,n,i,r){var o="playVOD()";v.checkArgCount(arguments.length,5,o);var s={screen:n,volume:i};return this.playStreamOnDemand(t,e,s,r)}},{key:"stop",value:function(t){return l.output("Triggered: stop()","log","fcall",t),{stop:this.processor.createEventStop(t)}}},{key:"skip",value:function(t){return l.output("Triggered: skip()","log","fcall"),{skip:this.processor.createEventSkip(t)}}},{key:"volume",value:function(t){var e="volume()";l.output("Triggered: "+e,"log","fcall",t),v.checkArgCount(arguments.length,1,e);var n={volume:v.isStringAndNotEmpty(t,"volume",e)};return this.processor.isPlaying()&&this.processor.createEventVolume(t),n}},{key:"screen",value:function(t){var e="screen()";l.output("Triggered: "+e,"log","fcall",t),v.checkArgCount(arguments.length,1,e);var n={screen:v.isStringAndNotEmpty(t,"screen",e)};return this.processor.isPlaying()&&this.processor.createEventScreen(t),n}},{key:"setStreamPositionCallback",value:function(t){this.processor.setStreamPositionCallback(t)}},{key:"activateVisibility",value:function(){this.processor.activateVisibility()}}]),t}(),Pt=function(){function t(){i(this,t)}return a(t,null,[{key:"getCookie",value:function(t){var e=document.cookie.match("(^|;) ?"+t+"=([^;]*)(;|$)");return e?decodeURIComponent(e[2]):null}},{key:"setCookie",value:function(t,e){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},i=n.days,r=void 0===i?730:i,o=n.domain,s=n.sameSite,a=void 0===s?"None":s,u=new Date;u.setTime(u.getTime()+24*r*60*60*1e3);var c=t+"="+encodeURIComponent(e)+";path=/;expires="+u.toUTCString();o&&(c+=";domain="+o),c+=";sameSite="+a,"https:"===window.location.protocol&&(c+=";secure"),document.cookie=c}},{key:"deleteCookie",value:function(e){t.setCookie(e,"",{days:-1})}},{key:"isHttp",value:function(){if("undefined"!=typeof window){for(var t=window.document.getElementsByTagName("script"),e=0;e<t.length;e++)if(t[e]&&t[e].src.match(/\/\/[^/]*sensic.net\/\S*\.js$/))return null!==t[e].src.match(/^http:/);if("http:"===window.location.protocol)return!0}return!1}},{key:"isSensicDomain",value:function(){return/^https?:\/\/[^.]+\.sensic\.net(\/[^/?])*\/suiapi\.html/.test(window.location.href)}}]),t}();!function(t){t[t.NOT_ALLOWED=0]="NOT_ALLOWED",t[t.REQUIRE_CONSENT=1]="REQUIRE_CONSENT",t[t.REQUIRE_LI=2]="REQUIRE_LI"}(kt||(kt={}));var It=function(){function t(){i(this,t)}return a(t,null,[{key:"isValidTCData",value:function(t){return!!(t.vendor&&t.vendor.consents&&t.vendor.legitimateInterests&&t.purpose&&t.purpose.consents&&t.purpose.legitimateInterests)}},{key:"hasReadWrite",value:function(e){return t.hasPurpose(t.PURPOSE_READ_WRITE_ON_USER_DEVICE,e)}},{key:"hasMeasureAdPerformance",value:function(e){return t.hasPurpose(t.PURPOSE_MEASURE_AD_PERFORMANCE,e)}},{key:"hasMeasureContentPerformance",value:function(e){return t.hasPurpose(t.PURPOSE_MEASURE_CONTENT_PERFORMANCE,e)}},{key:"hasMarketResearch",value:function(e){return t.hasPurpose(t.PURPOSE_MARKET_RESEARCH,e)}},{key:"hasGfK",value:function(e){return t.isValidTCData(e)&&!0===e.vendor.consents[t.VENDOR_ID]}},{key:"hasPurpose",value:function(e,n){var i,r,o=null===(r=null===(i=n.publisher)||void 0===i?void 0:i.restrictions[e])||void 0===r?void 0:r[t.VENDOR_ID];return(void 0===o||o!==kt.NOT_ALLOWED)&&(t.isValidTCData(n)&&!0===n.purpose.consents[e])}}]),t}();It.VENDOR_ID=758,It.PURPOSE_READ_WRITE_ON_USER_DEVICE=1,It.PURPOSE_MEASURE_AD_PERFORMANCE=7,It.PURPOSE_MEASURE_CONTENT_PERFORMANCE=8,It.PURPOSE_MARKET_RESEARCH=9;var Et=function t(){i(this,t)};Et.version="2.1.0",Et.suiGeneratorUrl="es-config.sensic.net/suigenerator",Et.thirdPartyCookieIframeUrl="https://es-config.sensic.net/3pc.html",Et.panelcookie=["MEPP","GFKP","GFKM"],Et.suiPixelUrl=".trk.sensic.net/tp.gif",Et.tmpSuiPixelUrl=".tmptrk.sensic.net/tp.gif",Et.suiHtmlUrl="https://es-config.sensic.net/sui.html",Et.filecacheUrl="https://es-config.sensic.net/sui_fc",Et.featureFlagTcf=!0,Et.featureFlagVms2=!1,Et.suiLogging=1,Et.projectId="es1",Et.trackingUrl="https://es1-s2s.sensic.net";var Rt={TCF:Et.featureFlagTcf,VMS2:Et.featureFlagVms2},Ct=function(){function t(){i(this,t)}return a(t,null,[{key:"isEnabled",value:function(t){return!0===Rt[t]}}]),t}();function Tt(t){var e=t.optin,n=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return new Promise((function(t){return n?t(!0):void 0!==e?t(e):(setTimeout((function(){t(!1)}),1e4),void(window.__tcfapi&&Ct.isEnabled("TCF")?window.__tcfapi("addEventListener",2,(function(n,i){i||t(!1),n.gdprApplies||(t(e),window.__tcfapi("removeEventListener",2,(function(){}),n.listenerId)),!i||"tcloaded"!==n.eventStatus&&"useractioncomplete"!==n.eventStatus||(t(Ot(n)),window.__tcfapi("removeEventListener",2,(function(){}),n.listenerId))})):t(!0)))}))}function Ot(t){return It.hasGfK(t)&&It.hasMarketResearch(t)&&It.hasMeasureAdPerformance(t)&&It.hasMeasureContentPerformance(t)&&It.hasReadWrite(t)}var xt=function(t,e,n,i){return new(n||(n=Promise))((function(r,o){function s(t){try{u(i.next(t))}catch(t){o(t)}}function a(t){try{u(i.throw(t))}catch(t){o(t)}}function u(t){var e;t.done?r(t.value):(e=t.value,e instanceof n?e:new n((function(t){t(e)}))).then(s,a)}u((i=i.apply(t,e||[])).next())}))},Nt=function(){function t(){i(this,t),this.VERSION=Et.version,this.url=Et.suiHtmlUrl}return a(t,[{key:"init",value:function(t){var n,i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},r=arguments.length>2?arguments[2]:void 0;return xt(this,void 0,void 0,e().mark((function o(){var s,a,u;return e().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return l.info("Using VMS V1"),i.logLevel&&(l.logLevel=i.logLevel),i.logUrl&&(l.url=i.logUrl),e.next=5,Tt(i);case 5:s=e.sent,a=this.buildQuery(i),r&&(a+=this.createParam(a,"gnsui","1")),void 0!==i.suigen&&(a+=this.createParam(a,"suigen",String(i.suigen))),u=null!==(n=window.gfkS2sConf)&&void 0!==n?n:{media:"no_mediaid"},a+=this.createParam(a,"m",u.media),a+=this.createParam(a,"r",window.location.host),a+=this.createParam(a,"optin",s?"true":"false"),this.sensFrame((function(e){Ct.isEnabled("TCF"),t(e)}),a);case 14:case"end":return e.stop()}}),o,this)})))}},{key:"getSui",value:function(){return this.suiObj||void 0}},{key:"makeObject",value:function(t){try{return JSON.parse(t)}catch(e){return void l.log("JSON not valid: "+t)}}},{key:"buildQuery",value:function(t){var e=this,n="";return Object.keys(t).forEach((function(i){void 0!==t[i]&&(n+=e.createParam(n,i,String(t[i])))})),n}},{key:"createParam",value:function(t,e,n){return(t.length?"&":"?")+e+"="+encodeURIComponent(n)}},{key:"sensFrame",value:function(t,e){var n=this;if(this.ifr||(window.addEventListener("message",function(e){try{e.data.sensic&&e.data.sensic.hasOwnProperty("sui")&&(n.ifr.src&&l.log("iframe url: "+n.ifr.src),n.suiObj=e.data.sensic.sui&&n.makeObject(e.data.sensic.sui),t(n.getSui()))}catch(t){}}.bind(this),!1),this.ifr=document.createElement("iframe"),this.ifr.style.visibility="hidden",this.ifr.style.display="none",this.ifr.width="0",this.ifr.height="0",document.body.insertBefore(this.ifr,document.body.childNodes[0])),this.suiHtml){var i=atob(this.suiHtml);i=i.replace("query:null","query:"+JSON.stringify(e)),this.ifr.srcdoc=i}else{var r=this.url.replace(/^https?:/,Pt.isHttp()?"http:":"https:");this.ifr.src=r+e}}},{key:"removeSui",value:function(){this.ifr.contentWindow.postMessage("removeSui","*")}},{key:"objectToJsonString",value:function(t){var e="";for(var n in t)t.hasOwnProperty(n)&&(e+='"'+n+'":"'+t[n]+'",');return"{"+e.substring(0,e.length-1)+"}"}}]),t}();function At(){for(var t=Date.now().toString().substring(0,13).padStart(13,"0"),e="ABCDEF0123456789",n=e.length,i=56-t.length,r=0;r<i;r++)t+=e.charAt(Math.floor(Math.random()*n));return t}function Dt(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,i=new Array(e);n<e;n++)i[n]=t[n];return i}function Lt(t,e){return function(t){if(Array.isArray(t))return t}(t)||function(t,e){if("undefined"!=typeof Symbol&&Symbol.iterator in Object(t)){var n=[],i=!0,r=!1,o=void 0;try{for(var s,a=t[Symbol.iterator]();!(i=(s=a.next()).done)&&(n.push(s.value),!e||n.length!==e);i=!0);}catch(t){r=!0,o=t}finally{try{i||null==a.return||a.return()}finally{if(r)throw o}}return n}}(t,e)||function(t,e){if(t){if("string"==typeof t)return Dt(t,e);var n=Object.prototype.toString.call(t).slice(8,-1);return"Object"===n&&t.constructor&&(n=t.constructor.name),"Map"===n||"Set"===n?Array.from(t):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?Dt(t,e):void 0}}(t,e)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}var Vt=function(){function t(){i(this,t)}return a(t,null,[{key:"getWithTimeout",value:function(t){return new Promise((function(e,n){var i=setTimeout((function(){return n("Request Timeout")}),5e3),r=new XMLHttpRequest;r.onloadend=function(){return clearTimeout(i),199<r.status&&r.status<400?e(r):n(r)},r.open("GET",t),r.send()}))}},{key:"sendData",value:function(t,e){return new Promise((function(n,i){var r=new XMLHttpRequest;r.onloadend=function(){r.status>=200&&r.status<400?n():i()},r.open("POST",t,!0),r.setRequestHeader("Content-Type","text/plain"),r.send(JSON.stringify(e))}))}}]),t}(),Ht="sui_1pc";function Ut(){if(!Pt.getCookie(Ht)){var t=At();Pt.setCookie(Ht,t,{sameSite:"Lax"})}return Pt.getCookie(Ht)}var Mt=/^[a-z0-9]{8}-[a-z0-9]{4}-[a-z0-9]{4}-[a-z0-9]{4}-[a-z0-9]{12}$/i;var Bt="sensic_sui_3pc",qt="sensic_sui_old_3pc";function _t(t,e){var n=new Promise((function(t,n){setTimeout((function(){return n("No value returned after ".concat(e," ms"))}),e)}));return Promise.race([t,n])}var Ft,jt,Gt,Wt=function(t,e,n,i){return new(n||(n=Promise))((function(r,o){function s(t){try{u(i.next(t))}catch(t){o(t)}}function a(t){try{u(i.throw(t))}catch(t){o(t)}}function u(t){var e;t.done?r(t.value):(e=t.value,e instanceof n?e:new n((function(t){t(e)}))).then(s,a)}u((i=i.apply(t,e||[])).next())}))},Kt=1e4;function Xt(){var t=arguments.length>0&&void 0!==arguments[0]&&arguments[0],e=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];void 0===Ft&&Yt();var n={};return e&&(Gt=_t(Qt(qt),Kt),setTimeout((function(){Ft.contentWindow.postMessage({readOldCookie:!0},"*")}),500),n.oldCookie=Gt),t&&(jt=_t(Qt(Bt),Kt),Ft.contentWindow.postMessage({readNewCookie:!0},"*"),n.newCookie=jt),n}function Yt(){(Ft=document.createElement("iframe")).style.visibility="hidden",Ft.style.display="none",Ft.width="0",Ft.height="0",Ft.src=Et.thirdPartyCookieIframeUrl.replace(/^https?:/,Pt.isHttp()?"http:":"https:");var t,e,n=document.body.childNodes[0];t=Ft,(e=n)&&e.parentNode?e.parentNode.insertBefore(t,e.nextSibling):document.body.appendChild(t)}function Qt(t){return new Promise((function(e){window.addEventListener("message",(function(n){n.data.hasOwnProperty(t)&&e(n.data[t])}))}))}function Jt(){var t;return Wt(this,void 0,void 0,e().mark((function n(){var i,r,o;return e().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(i=Xt(),r=i.oldCookie,o=null,void 0===(null===(t=null===document||void 0===document?void 0:document.body)||void 0===t?void 0:t.nodeName)){e.next=12;break}return e.prev=3,e.next=6,r;case 6:o=e.sent,e.next=12;break;case 9:e.prev=9,e.t0=e.catch(3),l.warn("Failed to collect oldCookie: "+e.t0.toString());case 12:return e.abrupt("return",o);case 13:case"end":return e.stop()}}),n,null,[[3,9]])})))}function $t(){var t="https://fc-id.sensic.net/".replace(/^https?:/,Pt.isHttp()?"http:":"https:");return new Promise((function(e,n){var i=new XMLHttpRequest;i.onloadend=function(){i.status>=200&&i.status<=299?e(i.response):n("".concat(t," returned ").concat(i.status))},i.open("GET",t,!0),i.send()}))}var zt=function(t,e,n,i){return new(n||(n=Promise))((function(r,o){function s(t){try{u(i.next(t))}catch(t){o(t)}}function a(t){try{u(i.throw(t))}catch(t){o(t)}}function u(t){var e;t.done?r(t.value):(e=t.value,e instanceof n?e:new n((function(t){t(e)}))).then(s,a)}u((i=i.apply(t,e||[])).next())}))};function Zt(){return _t(new Promise((function(t,e){Ct.isEnabled("TCF")||e("TCF feature flag is disabled"),window.__tcfapi||e("No __tcfapi found."),window.__tcfapi("getTCData",2,(function(e,n){!n||"tcloaded"!==e.eventStatus&&"useractioncomplete"!==e.eventStatus||t(e.tcString)}),[758])})),1e3)}function te(){return zt(this,void 0,void 0,e().mark((function t(){var n,i,r,o,s,a,u,c,f,h,d;return e().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:n=Xt(!0),i=n.oldCookie,r=n.newCookie,o=[["sui_1pc",Ut()],["ai",(e=void 0,v=void 0,v=null===(e=null===window||void 0===window?void 0:window.gfkS2sConf)||void 0===e?void 0:e.ai,Mt.test(v)&&"00000000-0000-0000-0000-000000000000"!==v?v:null)],["sui_fc",$t()],["sui_3pc",r],["sui_old_3pc",i],["external",window.gfkS2sConf?window.gfkS2sConf.extID:window.gfkConnectorConf?window.gfkConnectorConf.extID:void 0]],s={},a=0,u=o;case 4:if(!(a<u.length)){t.next=19;break}return c=Lt(u[a],2),f=c[0],h=c[1],t.prev=6,t.next=9,h;case 9:(d=t.sent)&&(s[f]=d),t.next=16;break;case 13:t.prev=13,t.t0=t.catch(6),l.warn("Failed to collect ID '".concat(f,"': ")+t.t0.toString());case 16:a++,t.next=4;break;case 19:return t.abrupt("return",s);case 20:case"end":return t.stop()}var e,v}),t,null,[[6,13]])})))}function ee(){var t=new URL("id",Et.trackingUrl);return Pt.isHttp()?t.protocol="http:":t.protocol="https:",t}var ne=function(t,n,i){var r=arguments.length>3&&void 0!==arguments[3]&&arguments[3],o=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"1";return zt(this,void 0,void 0,e().mark((function s(){var a,u;return e().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return a={version:o,source:"sensic-sdk-web",id:Object.assign({},t),privacy:{providedOptin:n},tracking:i},e.prev=1,e.next=4,Zt();case 4:a.privacy.tcString=e.sent,e.next=10;break;case 7:e.prev=7,e.t0=e.catch(1),l.warn("Could not determine TC string: "+e.t0);case 10:if(!i||!r){e.next=17;break}return e.t1=Object,e.t2=a.id,e.next=15,te();case 15:e.t3=e.sent,e.t1.assign.call(e.t1,e.t2,e.t3);case 17:return l.log("VMS privacy settings:, ".concat(JSON.stringify(a,null,2))),u=ee(),e.next=21,Vt.sendData(u.href,a);case 21:case"end":return e.stop()}}),s,null,[[1,7]])})))},ie=function(t,e,n,i){return new(n||(n=Promise))((function(r,o){function s(t){try{u(i.next(t))}catch(t){o(t)}}function a(t){try{u(i.throw(t))}catch(t){o(t)}}function u(t){var e;t.done?r(t.value):(e=t.value,e instanceof n?e:new n((function(t){t(e)}))).then(s,a)}u((i=i.apply(t,e||[])).next())}))};function re(t,e){var n=Pt.isHttp()?"http://":"https://",i=(t||"error-got-empty-id").replace("|","-")+(e?Et.tmpSuiPixelUrl:Et.suiPixelUrl);return new URL(n+i)}function oe(t,e){var n,i=e.searchParams,r=new URLSearchParams(window.location.search);(null===(n=window.gfkS2sConf)||void 0===n?void 0:n.media)&&i.append("m",window.gfkS2sConf.media);for(var o=0,s=["r","m","paneluserid","hhid","uid","pid","origin"];o<s.length;o++){var a=s[o];r.has(a)&&i.append(a,r.get(a))}i.append("r",window.location.host),i.append("p",Et.projectId),i.append("instanceid",t)}var se,ae,ue=(se=function(t){return new Promise((function(e){var n=new XMLHttpRequest;n.onreadystatechange=function(){n.readyState==XMLHttpRequest.DONE&&e()},n.onload=function(){if(window.top.postMessage({relayRequestServerDate:n.getResponseHeader("Date")},"*"),n.getAllResponseHeaders().includes("x-location")){var t=new XMLHttpRequest;t.open("GET",n.getResponseHeader("x-location"),!0),t.send()}},t+="&redirect=manual",n.open("GET",t,!0),n.send()}))},function(t){var n=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return ie(this,void 0,void 0,e().mark((function i(){var r;return e().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,r=re(t,n),oe(t,r),l.log("Relay ID: "+r),e.next=6,se(r.href);case 6:return e.abrupt("return",e.sent);case 9:e.prev=9,e.t0=e.catch(0),l.error("Failed to send relay request: "+e.t0.message);case 12:case"end":return e.stop()}}),i,null,[[0,9]])})))}),ce=function(t,e,n,i){return new(n||(n=Promise))((function(r,o){function s(t){try{u(i.next(t))}catch(t){o(t)}}function a(t){try{u(i.throw(t))}catch(t){o(t)}}function u(t){var e;t.done?r(t.value):(e=t.value,e instanceof n?e:new n((function(t){t(e)}))).then(s,a)}u((i=i.apply(t,e||[])).next())}))},le=function(){function t(){i(this,t),this.instanceID=At(),this.sui={id:this.instanceID,lt:0,cd:Date.now()}}return a(t,[{key:"init",value:function(t){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return ce(this,void 0,void 0,e().mark((function i(){var r,o=this;return e().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return l.info("Using VMS V2"),t(this.sui),ue(this.instanceID,!0),e.next=5,this.hasOldPanelCookie();case 5:r=e.sent,Tt(n,r).then((function(t){ne({instanceid:o.instanceID},n.optin,t,!0,"2")}));case 7:case"end":return e.stop()}}),i,this)})))}},{key:"getSui",value:function(){return this.sui}},{key:"hasOldPanelCookie",value:function(){return ce(this,void 0,void 0,e().mark((function t(){var n;return e().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.prev=0,t.next=3,Jt();case 3:return n=t.sent,t.abrupt("return",void 0!==(null==n?void 0:n.paneluserid)||void 0!==(null==n?void 0:n.uid)||void 0!==(null==n?void 0:n.hhid)||void 0!==(null==n?void 0:n.pid));case 7:t.prev=7,t.t0=t.catch(0),l.error("Failed to get oldPanelCookie: "+t.t0.message);case 10:case"end":return t.stop()}}),t,null,[[0,7]])})))}}]),t}(),fe=function(t,e,n,i){return new(n||(n=Promise))((function(r,o){function s(t){try{u(i.next(t))}catch(t){o(t)}}function a(t){try{u(i.throw(t))}catch(t){o(t)}}function u(t){var e;t.done?r(t.value):(e=t.value,e instanceof n?e:new n((function(t){t(e)}))).then(s,a)}u((i=i.apply(t,e||[])).next())}))},he=1,de=new Nt,ve=new le;function me(t){return fe(this,void 0,void 0,e().mark((function n(){var i;return e().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:he>1&&""===t&&l.output("Can not use SUI Object. There was an error creating the SUI by Sensic server.","error"),t&&""!==t||he>1?(window.gfks?window.gfks=wt:(l.output("You are using a deprecated tag. Please visit https://confluence-docu.gfk.com/display/SENSIC/Adding+the+Tag and update your tag.","warn"),window.s=wt),window.gfkS2s.agents.forEach((function(t){var e=t.a;t.a=new wt(e.config,e.pId,(function(){return e.p}),window.s2sSdkConfig),l.output('Processing started for player "'+e.pId+'"',"info"),e.queue.forEach((function(n){l.output('Method "'+n.f+'" was executed for player "'+e.pId+'" before SDK loaded',"info"),t.a[n.f].apply(t.a,n.a)})),t.a.setStreamPositionCallback(e.cb)})),window.gfkS2s.onSdkLoaded&&window.gfkS2s.onSdkLoaded(),window.gfkS2s.getSui=function(){return de.getSui()},window.gfkS2s.getInstanceID=function(){var t;return null===(t=ve.getSui())||void 0===t?void 0:t.id},i=(new Date).getTime()-ae,l.output("Agents initialized after ".concat(i," ms"),"debug")):1===he&&(he++,d.loadSUI(window.gfkS2sConf,de,ve,me));case 2:case"end":return e.stop()}}),n)})))}l.readFromTagConf(),l.readFromLocalStorage(),Array.prototype.forEach&&Array.prototype.indexOf&&window.JSON?(ae=(new Date).getTime(),window.s2sSdkConfig=new r,d.setConfig(window.s2sSdkConfig),d.loadSUI(window.gfkS2sConf,de,ve,me),d.setTimeOffset()):l.output("Device doesn't support ECMAScript 5","error")}()}();